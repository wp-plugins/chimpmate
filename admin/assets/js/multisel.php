(function(e){"use strict";function t(t,n){var r=this,i=t.attr("wpmc-sel-name")||n.name||"";t.parent().hide();var s=t.css("width");t.parent().show();if(s=="0px"){s=t.outerWidth()+20}this.$el=t.hide();this.options=n;this.$parent=e("<div"+e.map(["class","title"],function(e){var t=r.$el.attr(e)||"";t=(e==="class"?"ms-parent"+(t?" ":""):"")+t;return t?" "+e+'="'+t+'"':""}).join("")+" />");this.$choice=e('<button type="button" class="ms-choice"><span class="placeholder">'+n.placeholder+"</span><div></div></button>");this.$drop=e('<div class="ms-drop '+n.position+'"></div>');this.$el.after(this.$parent);this.$parent.append(this.$choice);this.$parent.append(this.$drop);if(this.$el.prop("disabled")){this.$choice.addClass("disabled")}this.$parent.css("width",n.width||s);if(!this.options.keepOpen){e("body").click(function(t){if(e(t.target)[0]===r.$choice[0]||e(t.target).parents(".ms-choice")[0]===r.$choice[0]){return}if((e(t.target)[0]===r.$drop[0]||e(t.target).parents(".ms-drop")[0]!==r.$drop[0])&&r.options.isOpen){r.close()}})}this.selectAllName='name="selectAll'+i+'"';this.selectGroupName='name="selectGroup'+i+'"';this.selectItemName='name="'+i+'"'}t.prototype={constructor:t,init:function(){var t=this,n=[];if(this.options.filter){n.push('<div class="ms-search">','<input type="text" autocomplete="off" autocorrect="off" autocapitilize="off" spellcheck="false">',"</div>")}n.push("<ul>");if(this.options.selectAll&&!this.options.single){n.push('<li class="ms-select-all">',"<label>",'<input type="checkbox" '+this.selectAllName+" /> ",this.options.selectAllDelimiter[0]+this.options.selectAllText+this.options.selectAllDelimiter[1],"</label>","</li>")}e.each(this.$el.children(),function(e,r){n.push(t.optionToHtml(e,r))});n.push('<li class="ms-no-results">'+this.options.noMatchesFound+"</li>");n.push("</ul>");this.$drop.html(n.join(""));this.$drop.find("ul").css("max-height",this.options.maxHeight+"px");this.$drop.find(".multiple").css("width",this.options.multipleWidth+"px");this.$searchInput=this.$drop.find(".ms-search input");this.$selectAll=this.$drop.find("input["+this.selectAllName+"]");this.$selectGroups=this.$drop.find("input["+this.selectGroupName+"]");this.$selectItems=this.$drop.find("input["+this.selectItemName+"]:enabled");this.$disableItems=this.$drop.find("input["+this.selectItemName+"]:disabled");this.$noResults=this.$drop.find(".ms-no-results");this.events();this.updateSelectAll(true);this.update(true);if(this.options.isOpen){this.open()}},optionToHtml:function(t,n,r,i){var s=this,o=e(n),u=[],a=this.options.multiple,f=["class","title"],l=e.map(f,function(e,t){var n=e==="class"&&a;var r=o.attr(e)||"";return n||r?" "+e+'="'+(n?"multiple"+(r?" ":""):"")+r+'"':""}).join(""),c,h=this.options.single?"radio":"checkbox";if(o.is("option")){var p=o.val(),d=s.options.textTemplate(o),v=s.$el.attr("multiple")!=undefined?o.prop("selected"):o.attr("selected")=="selected",m=this.options.styler(p)?' style="'+this.options.styler(p)+'"':"";c=i||o.prop("disabled");if(this.options.blockSeparator>""&&this.options.blockSeparator==o.val()){u.push("<li"+l+m+">",'<label class="'+this.options.blockSeparator+(c?"disabled":"")+'">',d,"</label>","</li>")}else{u.push("<li"+l+m+">","<label"+(c?' class="disabled"':"")+">",'<input type="'+h+'" '+this.selectItemName+' value="'+p+'"'+(v?' checked="checked"':"")+(c?' disabled="disabled"':"")+(r?' data-group="'+r+'"':"")+"/> ",d,"</label>","</li>")}}else if(!r&&o.is("optgroup")){var g="group_"+t,y=o.attr("label");c=o.prop("disabled");u.push('<li class="group">','<label class="optgroup'+(c?" disabled":"")+'" data-group="'+g+'">',this.options.hideOptgroupCheckboxes?"":'<input type="checkbox" '+this.selectGroupName+(c?' disabled="disabled"':"")+" /> ",y,"</label>","</li>");e.each(o.children(),function(e,t){u.push(s.optionToHtml(e,t,g,c))})}return u.join("")},events:function(){function n(e){e.preventDefault();t[t.options.isOpen?"close":"open"]()}var t=this;var r=this.$el.parent().closest("label")[0]||e("label[for="+this.$el.attr("id")+"]")[0];if(r){e(r).off("click").on("click",function(e){if(e.target.nodeName.toLowerCase()!=="label"||e.target!==this){return}n(e);if(!t.options.filter||!t.options.isOpen){t.focus()}e.stopPropagation()})}this.$choice.off("click").on("click",n).off("focus").on("focus",this.options.onFocus).off("blur").on("blur",this.options.onBlur);this.$parent.off("keydown").on("keydown",function(e){switch(e.which){case 27:t.close();t.$choice.focus();break}});this.$searchInput.off("keydown").on("keydown",function(e){if(e.keyCode===9&&e.shiftKey){t.close()}}).off("keyup").on("keyup",function(e){if(t.options.filterAcceptOnEnter&&(e.which===13||e.which==32)&&t.$searchInput.val()){t.$selectAll.click();t.close();t.focus();return}t.filter()});this.$selectAll.off("click").on("click",function(){var n=e(this).prop("checked"),r=t.$selectItems.filter(":visible");if(r.length===t.$selectItems.length){t[n?"checkAll":"uncheckAll"]()}else{t.$selectGroups.prop("checked",n);r.prop("checked",n);t.options[n?"onCheckAll":"onUncheckAll"]();t.update()}});this.$selectGroups.off("click").on("click",function(){var n=e(this).parent().attr("data-group"),r=t.$selectItems.filter(":visible"),i=r.filter('[data-group="'+n+'"]'),s=i.length!==i.filter(":checked").length;i.prop("checked",s);t.updateSelectAll();t.update();t.options.onOptgroupClick({label:e(this).parent().text(),checked:s,children:i.get()})});this.$selectItems.off("click").on("click",function(){t.updateSelectAll();t.update();t.updateOptGroupSelect();t.options.onClick({label:e(this).parent().text(),value:e(this).val(),checked:e(this).prop("checked")});if(t.options.single&&t.options.isOpen&&!t.options.keepOpen){t.close()}})},open:function(){if(this.$choice.hasClass("disabled")){return}this.options.isOpen=true;this.$choice.find(">div").addClass("open");this.$drop.slideDown();this.$selectAll.parent().show();this.$noResults.hide();if(this.$el.children().length===0){this.$selectAll.parent().hide();this.$noResults.show()}if(this.options.container){var t=this.$drop.offset();this.$drop.appendTo(e(this.options.container));this.$drop.offset({top:t.top,left:t.left})}if(this.options.filter){this.$searchInput.val("");this.$searchInput.focus();this.filter()}this.options.onOpen()},close:function(){this.options.isOpen=false;this.$choice.find(">div").removeClass("open");this.$drop.slideUp();if(this.options.container){this.$parent.append(this.$drop);this.$drop.css({top:"auto",left:"auto"})}this.options.onClose()},update:function(t){var n=this.getSelects(),r=this.$choice.find(">span");if(n.length===0){r.addClass("placeholder").html(this.options.placeholder)}else if(this.options.countSelected&&n.length<this.options.minumimCountSelected){r.removeClass("placeholder").html((this.options.displayValues?n:this.getSelects("text")).join(this.options.delimiter))}else if(this.options.allSelected&&n.length===this.$selectItems.length+this.$disableItems.length){r.removeClass("placeholder").html(this.options.allSelected)}else if((this.options.countSelected||this.options.etcaetera)&&n.length>this.options.minumimCountSelected){if(this.options.etcaetera){r.removeClass("placeholder").html((this.options.displayValues?n:this.getSelects("text").slice(0,this.options.minumimCountSelected)).join(this.options.delimiter)+"...")}else{r.removeClass("placeholder").html(this.options.countSelected.replace("#",n.length).replace("%",this.$selectItems.length+this.$disableItems.length))}}else{r.removeClass("placeholder").html((this.options.displayValues?n:this.getSelects("text")).join(this.options.delimiter))}this.$el.val(this.getSelects());this.$drop.find("li").removeClass("selected");this.$drop.find("input["+this.selectItemName+"]:checked").each(function(){e(this).parents("li").first().addClass("selected")});if(!t){this.$el.trigger("change")}},updateSelectAll:function(e){var t=this.$selectItems;if(!e){t=t.filter(":visible")}this.$selectAll.prop("checked",t.length&&t.length===t.filter(":checked").length);if(this.$selectAll.prop("checked")){this.options.onCheckAll()}},updateOptGroupSelect:function(){var t=this.$selectItems.filter(":visible");e.each(this.$selectGroups,function(n,r){var i=e(r).parent().attr("data-group"),s=t.filter('[data-group="'+i+'"]');e(r).prop("checked",s.length&&s.length===s.filter(":checked").length)})},getSelects:function(t){var n=this,r=[],i=[];this.$drop.find("input["+this.selectItemName+"]:checked").each(function(){r.push(e(this).parents("li").first().text());i.push(e(this).val())});if(t==="text"&&this.$selectGroups.length){r=[];this.$selectGroups.each(function(){var t=[],i=e.trim(e(this).parent().text()),s=e(this).parent().data("group"),o=n.$drop.find("["+n.selectItemName+'][data-group="'+s+'"]'),u=o.filter(":checked");if(u.length===0){return}t.push("[");t.push(i);if(o.length>u.length){var a=[];u.each(function(){a.push(e(this).parent().text())});t.push(": "+a.join(", "))}t.push("]");r.push(t.join(""))})}return t==="text"?r:i},setSelects:function(t){var n=this;this.$selectItems.prop("checked",false);e.each(t,function(e,t){n.$selectItems.filter('[value="'+t+'"]').prop("checked",true)});this.$selectAll.prop("checked",this.$selectItems.length===this.$selectItems.filter(":checked").length);this.update()},enable:function(){this.$choice.removeClass("disabled")},disable:function(){this.$choice.addClass("disabled")},checkAll:function(){this.$selectItems.prop("checked",true);this.$selectGroups.prop("checked",true);this.$selectAll.prop("checked",true);this.update();this.options.onCheckAll()},uncheckAll:function(){this.$selectItems.prop("checked",false);this.$selectGroups.prop("checked",false);this.$selectAll.prop("checked",false);this.update();this.options.onUncheckAll()},focus:function(){this.$choice.focus();this.options.onFocus()},blur:function(){this.$choice.blur();this.options.onBlur()},refresh:function(){this.init()},filter:function(){var t=this,n=e.trim(this.$searchInput.val()).toLowerCase();if(n.length===0){this.$selectItems.parent().show();this.$disableItems.parent().show();this.$selectGroups.parent().show()}else{this.$selectItems.each(function(){var t=e(this).parent();t[t.text().toLowerCase().indexOf(n)<0?"hide":"show"]()});this.$disableItems.parent().hide();this.$selectGroups.each(function(){var n=e(this).parent();var r=n.attr("data-group"),i=t.$selectItems.filter(":visible");n[i.filter('[data-group="'+r+'"]').length===0?"hide":"show"]()});if(this.$selectItems.filter(":visible").length){this.$selectAll.parent().show();this.$noResults.hide()}else{this.$selectAll.parent().hide();this.$noResults.show()}}this.updateOptGroupSelect();this.updateSelectAll()}};e.fn.multipleSelect=function(){var n=arguments[0],r=arguments,i,s=["getSelects","setSelects","enable","disable","checkAll","uncheckAll","focus","blur","refresh"];this.each(function(){var o=e(this),u=o.data("multipleSelect"),a=e.extend({},e.fn.multipleSelect.defaults,o.data(),typeof n==="object"&&n);if(!u){u=new t(o,a);o.data("multipleSelect",u)}if(typeof n==="string"){if(e.inArray(n,s)<0){throw"Unknown method: "+n}i=u[n](r[1])}else{u.init();if(r[1]){i=u[r[1]].apply(u,[].slice.call(r,2))}}});return i?i:this};e.fn.multipleSelect.defaults={name:"",isOpen:false,placeholder:"",selectAll:true,selectAllText:"Select all",selectAllDelimiter:["[","]"],allSelected:"All selected",minumimCountSelected:3,countSelected:"# of % selected",noMatchesFound:"No matches found",multiple:false,multipleWidth:80,single:false,filter:false,width:undefined,maxHeight:250,container:null,position:"bottom",keepOpen:false,blockSeparator:"",displayValues:false,delimiter:", ",styler:function(){return false},textTemplate:function(e){return e.text()},onOpen:function(){return false},onClose:function(){return false},onCheckAll:function(){return false},onUncheckAll:function(){return false},onFocus:function(){return false},onBlur:function(){return false},onOptgroupClick:function(){return false},onClick:function(){return false}}})(jQuery);